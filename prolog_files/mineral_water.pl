% Define the springs with their properties
spring(1, 'Belchin-Verila', 46, 354, 65.36, 0, 2.5, [6, 13.83, 122.22, 36.01, 6.11, 5.35, 0, 0], [0.1, 0.06, 94.25, 0.9, 3.61, 0, 0.03, 0.0002]).
spring(2, 'Sudievo', 29, 316.15, 42.8, 0, 0.07, [6.35, 20.15, 23.25, 60.01, 73.22, 6.39, 5, 0.05], [0.05, 0.05, 82.73, 0.62, 0.60, 0.12, 0.03, 0.01]).
spring(3, 'Velingrad-Kamenitza', 87.7, 669.53, 106.46, 0, 3, [10.58, 16.31, 234.35, 6, 140.34, 0.8, 5, 0.05], [0.05, 0.2, 139, 6.72, 8.62, 0.12, 0.03, 0.01]).
spring(4, 'Eleshnitza', 56.6, 276.87, 65.45, 0, 0.34, [8.98, 4.25, 41.97, 39.01, 39.66, 8.52, 5, 0.05], [0.05, 0.05, 66.41, 1.19, 1.4, 0.12, 0.03, 0.01]).
spring(5, 'Bedenski bani', 73.3, 1714.31, 129.20, 154, 1.5, [6.96, 43.26, 329.2, 6, 768.83, 0, 5, 0.05], [0.05, 0.77, 338.20, 29.16, 58.52, 9.73, 0.45, 0.04]).
spring(6, 'Haskovski mineralni bani', 57.5, 1667, 80.41, 22, 336.26, [4.05, 62.80, 857.16, 6, 136.68, 0, 7.35, 0.05], [0.05, 0.1, 317.30, 20.18, 176.35, 3, 0.49, 0.84]).
spring(7, 'Hisariya', 48.5, 249, 61.9, 0, 0, [4.82, 7.8, 25.72, 7, 84.21, 2.27, 1, 0.3], [0.05, 0.05, 50.54, 1.66, 4.75, 0.12, 0.02, 0.02]).
spring(8, 'Pavel banya', 54.5, 633, 59.12, 1.76, 0.89, [15.18, 9.87, 21.81, 6, 352.89, 0, 1, 0.05], [0.05, 0.28, 155.57, 9.46, 8.12, 0.12, 0.03, 0.02]).
spring(9, 'Starozagoski mineralni bani', 31.9, 580, 24.78, 22, 0.35, [0.14, 8.79, 17.28, 6, 399.67, 0, 1, 0.05], [0.05, 0.05, 8.38, 1.8, 90.18, 29.18, 0.01, 0.02]).
spring(10, 'Batalova vodenica', 44, 269, 56.75, 0, 0.78, [1.76, 8.51, 47.12, 39.01, 44.54, 3.85, 1.33, 0.05], [0.05, 0.05, 68.03, 0.62, 1.64, 0.12, 0.02, 0.02]).
spring(11, 'Centralen kaptazh - Banya', 50.2, 346, 75.18, 0, 0.2, [4.42, 13.9, 77.77, 25, 65.90, 3.92, 1, 0.05], [0.05, 0.11, 74.27, 2.15, 2.91, 0.12, 0.01, 0.02]).
spring(12, 'Muzho banche - Banya', 34.4, 363, 75.36, 0, 0.5, [4.22, 14.18, 81.89, 12, 89.70, 1.15, 1, 0.2], [0.28, 0.14, 73.95, 2.97, 6.81, 0.85, 0.01, 0.02]).
spring(13, 'Zhensko banche - Banya', 36.2, 361, 75.09, 0, 0.5, [4.22, 13.83, 83.95, 15, 85.43, 2.18, 1, 0.05], [0.05, 0.13, 73.64, 2.87, 6.21, 0.67, 0.01, 0.02]).
spring(14, 'Vetren dol', 59, 725, 102.3, 0, 0.5, [5.35, 21.63, 253.28, 6, 161.7, 0, 1, 0.05], [0.05, 0.13, 149, 8.03, 20.64, 2.38, 0.02, 0.02]).
spring(15, 'Rudartsi', 27, 270, 37.44, 14.1, 0.8, [1.35, 12.53, 91.15, 15, 42.71, 1.37, 1, 0.05], [0.05, 0.05, 62.67, 0.61, 6.41, 0.12, 0.02, 0.02]).
spring(16, 'Hadzhi Dimitar', 22.5, 392, 35.5, 7.68, 1.4, [0.32, 3.55, 16.05, 6, 254.24, 0, 1, 0.05], [0.05, 0.5, 5.3, 2.19, 50.10, 24.32, 0.02, 0.02]).
spring(17, 'Sandanski', 72.5, 667, 126.9, 0, 0.02, [6.07, 12.06, 141.56, 6, 216.61, 0, 1, 0.05], [0.05, 0.07, 145.63, 5.9, 11.72, 0.24, 0.02, 0.02]).
spring(18, 'Mineralna voda - Vurbitsa', 13, 1680, 33.29, 52.80, 13.80, [0.39, 549.58, 39.30, 6, 573.57, 0, 1, 0.05], [0.05, 0.05, 320.31, 2.60, 137.27, 23.71, 0.04, 0.02]).
spring(19, 'Toplite izvori', 50.4, 338, 85.55, 25, 0.5, [5.47, 8.69, 66.66, 24, 64.07, 5.8, 1, 0.05], [0.05, 0.05, 79.26, 2.71, 1.8, 0.12, 0.03, 0.02]).
spring(20, 'Tulzata - Byalata laguna', 34, 599, 25.63, 18.3, 5.1, [0.32, 70.91, 31.27, 6, 329.5, 0, 1, 0.05], [0.06, 0.05, 57.95, 5.05, 49.10, 29.18, 0.23, 0.02]).
spring(21, 'Blagata voda', 47.3, 304, 62.48, 0.03, 0.15, [7.75, 5.03, 48.35, 27.01, 73.22, 4.24, 1, 0.05], [0.05, 0.1, 76.24, 1.43, 2, 0.12, 0.02, 0.02]).
spring(22, 'Choban cheshma', 25, 226, 54.52, 25, 0.5, [4.62, 7.8, 26.95, 9, 76.27, 1.1, 1, 0.05], [0.05, 0.17, 39.93, 1.76, 5.01, 0.12, 0.07, 0.02]).
spring(23, 'Domus dere', 19, 142, 42.35, 0, 0.51, [0.13, 4.79, 17.08, 22.2, 23.19, 4.19, 1, 0.05], [0.05, 0.05, 28.96, 0.42, 2.51, 0.12, 0.06, 0.02]).
spring(24, 'Dolna banya', 60, 523, 61.82, 0, 1.5, [11.66, 14.82, 245.25, 9, 59.8, 1.79, 1, 0.05], [0.05, 0.63, 106.28, 4.86, 9.22, 0.12, 0.02, 0.02]).

% Define the classification rules
classify_gas_water(Name, 'Carbonated') :- spring(_, Name, _, _, _, CO2, _, _, _), CO2 > 400.
classify_gas_water(Name, 'Sulfuric') :- spring(_, Name, _, _, _, _, HS, _, _), HS > 10.

classify_mineralized_water(Name, 'Hydrocarbonate') :- spring(_, Name, _, _, _, _, _, Anions, _), member(CO3, Anions), CO3 > 1200.
classify_mineralized_water(Name, 'Sulfate') :- spring(_, Name, _, _, _, _, _, Anions, _), member(SO4, Anions), SO4 > 950.
classify_mineralized_water(Name, 'Sodium-chloride') :- spring(_, Name, _, _, _, _, _, Anions, Kations), member(Cl, Anions), member(Na, Kations), Cl > 1200, Na > 400.
classify_mineralized_water(Name, 'Magnesium') :- spring(_, Name, _, _, _, _, _, _, Kations), member(Mg, Kations), Mg > 50.
classify_mineralized_water(Name, 'Sodium') :- spring(_, Name, _, _, _, _, _, _, Kations), member(Na, Kations), Na > 20.
classify_mineralized_water(Name, 'Calcium') :- spring(_, Name, _, _, _, _, _, _, Kations), member(Ca, Kations), Ca > 300.

classify_bio_active(Name, 'Silica') :- spring(_, Name, _, _, H2SiO3, _, _, _, _), H2SiO3 > 50.
classify_bio_active(Name, 'Fluoride') :- spring(_, Name, _, _, _, _, _, Anions, _), member(F, Anions), F > 1500.
classify_bio_active(Name, 'Iron-containing') :- spring(_, Name, _, _, _, _, _, _, Kations), member(Fe, Kations), Fe > 25.

% Classification for temperature
classify_temperature(Name, 'Cold') :- spring(_, Name, Temp, _, _, _, _, _, _), Temp < 20.
classify_temperature(Name, 'Hypothermal') :- spring(_, Name, Temp, _, _, _, _, _, _), Temp >= 20, Temp =< 37.
classify_temperature(Name, 'Thermal') :- spring(_, Name, Temp, _, _, _, _, _, _), Temp > 37, Temp =< 50.
classify_temperature(Name, 'Hyperthermal') :- spring(_, Name, Temp, _, _, _, _, _, _), Temp > 50.

% Classification for mineralization
classify_mineralization(Name, 'Very Low Mineralization') :- spring(_, Name, _, Mineralization, _, _, _, _, _), Mineralization < 50.
classify_mineralization(Name, 'Low Mineralization') :- spring(_, Name, _, Mineralization, _, _, _, _, _), Mineralization >= 50, Mineralization =< 500.
classify_mineralization(Name, 'High Mineralization') :- spring(_, Name, _, Mineralization, _, _, _, _, _), Mineralization > 500.

% Query to classify all springs
classify_all :-
    spring(_, Name, _, _, _, _, _, _, _),
    (classify_gas_water(Name, GasClass) -> format('~w is a ~w gas water.~n', [Name, GasClass]) ; true),
    (classify_mineralized_water(Name, MineralClass) -> format('~w is a ~w mineralized water.~n', [Name, MineralClass]) ; true),
    (classify_bio_active(Name, BioClass) -> format('~w is a ~w bio-active water.~n', [Name, BioClass]) ; true),
    (classify_temperature(Name, TempClass) -> format('~w is a ~w spring.~n', [Name, TempClass]) ; true),
    (classify_mineralization(Name, MineralizationClass) -> format('~w has ~w.~n', [Name, MineralizationClass]) ; true),
    fail.
classify_all.

% Medical issues and the waters that help
medical_issue('Physical trauma and skin problems and infections', 'Sulfuric').
medical_issue('Diseases with increased acidity in the organism', 'Hydrocarbonate').
medical_issue('Help with weightloss, colitis, gall stones, gout, diabetes, heavy metal poisoning', 'Sulfate').
medical_issue('Help the supporting motor apparatus, nervous system, gall diseases, colitis, gastritis, anemia, diabetes, thrombophlebitis', 'Sodium-chloride').
medical_issue('Rachitis, trauma from breakages, tooth cavity profilactics, chronic inflamation of the airways', 'Calcium').
medical_issue('Lowering cholesterol, relieve spasms, relieve neurosis, obesity and diabetes', 'Magnesium').
medical_issue('Help with anemia, increase immune response', 'Iron-containing').
medical_issue('Detoxing, help with colitis and ulcers, gall inflamation, improve elacticity of joints and tissues, helps with supporting motor appatatus issues', 'Silica').
medical_issue('Prevent cavities and osteoporosis, help with trauma and breakages, urological issues and strengthen hair and nails', 'Fluoride').

% Determine which springs are good for which medical issues
good_for_medical_issue(MedicalIssue, Name) :-
    medical_issue(MedicalIssue, WaterType),
    (classify_gas_water(Name, WaterType) ; classify_mineralized_water(Name, WaterType) ; classify_bio_active(Name, WaterType)),
    format('~w is good for ~w.~n', [Name, MedicalIssue]).

% Query to determine all springs good for a specific medical issue
good_for_medical_issues :-
    medical_issue(MedicalIssue, _),
    spring(_, Name, _, _, _, _, _, _, _),
    good_for_medical_issue(MedicalIssue, Name),
    fail.
good_for_medical_issues.

% Function to classify a specific spring by name
classify_spring(Name) :-
    (classify_gas_water(Name, GasClass) -> format('~w is a ~w gas water.~n', [Name, GasClass]) ; true),
    (classify_mineralized_water(Name, MineralClass) -> format('~w is a ~w mineralized water.~n', [Name, MineralClass]) ; true),
    (classify_bio_active(Name, BioClass) -> format('~w is a ~w bio-active water.~n', [Name, BioClass]) ; true),
    (classify_temperature(Name, TempClass) -> format('~w is a ~w spring.~n', [Name, TempClass]) ; true),
    (classify_mineralization(Name, MineralizationClass) -> format('~w has ~w.~n', [Name, MineralizationClass]) ; true).

% Function% Function to determine the medical problems a specific spring helps with
spring_medical_issues(Name) :-
    medical_issue(MedicalIssue, WaterType),
    (classify_gas_water(Name, WaterType) ; classify_mineralized_water(Name, WaterType) ; classify_bio_active(Name, WaterType)),
    format('~w helps with ~w.~n', [Name, MedicalIssue]),
    fail.
spring_medical_issues(_).

% Function to query springs by temperature class
springs_by_temperature_class(TempClass) :-
    classify_temperature(Name, TempClass),
    format('~w is a ~w spring.~n', [Name, TempClass]),
    fail.
springs_by_temperature_class(_).

% Function to query springs by gas class
springs_by_gas_class(GasClass) :-
    classify_gas_water(Name, GasClass),
    format('~w is a ~w gas water.~n', [Name, GasClass]),
    fail.
springs_by_gas_class(_).

% Function to query springs by mineralization class
springs_by_mineralization_class(MineralizationClass) :-
    classify_mineralization(Name, MineralizationClass),
    format('~w has ~w.~n', [Name, MineralizationClass]),
    fail.
springs_by_mineralization_class(_).

% Function to query springs by bio-active class
springs_by_bio_active_class(BioClass) :-
    classify_bio_active(Name, BioClass),
    format('~w is a ~w bio-active water.~n', [Name, BioClass]),
    fail.
springs_by_bio_active_class(_).

% Example queries:
% ?- classify_spring('Belchin-Verila').
% ?- spring_medical_issues('Belchin-Verila').
% ?- springs_by_temperature_class('Thermal').
% ?- springs_by_gas_class('Carbonated').
% ?- springs_by_mineralization_class('High Mineralization').
% ?- springs_by_bio_active_class('Silica').

% Natural language query processor
process_query(Query) :-
    string_lower(Query, LowerQuery),
    (   sub_string(LowerQuery, _, _, _, "classify") -> process_classify_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "medical issues") -> process_medical_issues_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "cold") -> process_temperature_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "hupothermal") -> process_temperature_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "thermal") -> process_temperature_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "hyperthermal") -> process_temperature_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "gas") -> process_gas_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "mineralization") -> process_mineralization_query(LowerQuery)
    ;   sub_string(LowerQuery, _, _, _, "bio-active") -> process_bio_active_query(LowerQuery)
    ;   format("I'm sorry, I don't understand that query. Please try again.~n")
    ).

% Process classify spring query
process_classify_query(Query) :-
    split_string(Query, " ", "", Words),
    last(Words, SpringName),
    atom_string(SpringAtom, SpringName),
    classify_spring(SpringAtom).

% Process medical issues query
process_medical_issues_query(Query) :-
    split_string(Query, " ", "", Words),
    last(Words, SpringName),
    atom_string(SpringAtom, SpringName),
    spring_medical_issues(SpringAtom).

% Process temperature query
process_temperature_query(Query) :-
    (   sub_string(Query, _, _, _, "cold") -> springs_by_temperature_class('Cold')
    ;   sub_string(Query, _, _, _, "hypothermal") -> springs_by_temperature_class('Hypothermal')
    ;   sub_string(Query, _, _, _, "thermal") -> springs_by_temperature_class('Thermal')
    ;   sub_string(Query, _, _, _, "hyperthermal") -> springs_by_temperature_class('Hyperthermal')
    ;   format("Please specify a temperature class: cold, hypothermal, thermal, or hyperthermal.~n")
    ).

% Process gas query
process_gas_query(Query) :-
    (   sub_string(Query, _, _, _, "carbonated") -> springs_by_gas_class('Carbonated')
    ;   sub_string(Query, _, _, _, "sulfuric") -> springs_by_gas_class('Sulfuric')
    ;   format("Please specify a gas class: carbonated or sulfuric.~n")
    ).

% Process mineralization query
process_mineralization_query(Query) :-
    (   sub_string(Query, _, _, _, "very low") -> springs_by_mineralization_class('Very Low Mineralization')
    ;   sub_string(Query, _, _, _, "low") -> springs_by_mineralization_class('Low Mineralization')
    ;   sub_string(Query, _, _, _, "high") -> springs_by_mineralization_class('High Mineralization')
    ;   format("Please specify a mineralization class: very low, low, or high.~n")
    ).

% Process bio-active query
process_bio_active_query(Query) :-
    (   sub_string(Query, _, _, _, "silica") -> springs_by_bio_active_class('Silica')
    ;   sub_string(Query, _, _, _, "fluoride") -> springs_by_bio_active_class('Fluoride')
    ;   sub_string(Query, _, _, _, "iron") -> springs_by_bio_active_class('Iron-containing')
    ;   format("Please specify a bio-active class: silica, fluoride, or iron-containing.~n")
    ).

% Main query function
query(Input) :-
    process_query(Input).

% Example usage:
% ?- query("Show me thermal springs").
% ?- query("List carbonated gas waters").
% ?- query("What springs have high mineralization?").
% ?- query("Show me silica bio-active waters").
